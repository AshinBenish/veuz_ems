{% load static %}
<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/global.css' %}?v=0.01">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
        integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"
        integrity="sha512-KZmyTq3PLx9EZl0RHShHQuXtrvdJ+m35tuOiwlcZfs/rE7NZv29ygNA8SFCkMXTnYZQK2OX0Gm2qKGfvWEtRXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    {% block top_script %}
    {% endblock top_script %}
    <script>
        (function () {
            function isTokenExpired(token) {
                try {
                    var payload = JSON.parse(atob(token.split('.')[1]));
                    var now = Math.floor(Date.now() / 1000);
                    return payload.exp && payload.exp < now;
                } catch (e) {
                    return true;
                }
            }

            var publicPaths = ['/login/', '/register/'];
            var currentPath = window.location.pathname;
            var token = localStorage.getItem('accessToken');

            if (!publicPaths.includes(currentPath) && (!token || isTokenExpired(token))) {
                window.location.href = '/login/';
            }
        })();
    </script>
</head>

<body>
    <div class="min-h-screen bg-gray-50">
        <button
            class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3 fixed top-4 left-4 z-50 md:hidden bg-white shadow-md"><svg
                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-menu w-4 h-4">
                <line x1="4" x2="20" y1="12" y2="12"></line>
                <line x1="4" x2="20" y1="6" y2="6"></line>
                <line x1="4" x2="20" y1="18" y2="18"></line>
            </svg>
        </button>
        <div
            class="fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out -translate-x-full md:translate-x-0">
            <div class="flex flex-col h-full">
                <div
                    class="flex items-center justify-center h-16 bg-gradient-to-r from-green-600 to-emerald-600 text-white">
                    <h1 class="text-xl font-bold">EMS</h1>
                </div>
                <nav class="flex-1 px-4 py-6 space-y-2">
                    <a class="flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 {% if request.resolver_match.url_name == 'dashboard' %}bg-green-50 text-green-700 border-r-2 border-green-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900 {% endif %}"
                        href="{% url 'dashboard' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-layout-dashboard w-5 h-5 mr-3">
                            <rect width="7" height="9" x="3" y="3" rx="1"></rect>
                            <rect width="7" height="5" x="14" y="3" rx="1"></rect>
                            <rect width="7" height="9" x="14" y="12" rx="1"></rect>
                            <rect width="7" height="5" x="3" y="16" rx="1"></rect>
                        </svg>Dashboard
                    </a>
                    <a class="flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 {% if request.resolver_match.url_name == 'form_list' or request.resolver_match.url_name == 'form_designer' or request.resolver_match.url_name == 'form_edit' %}bg-green-50 text-green-700 border-r-2 border-green-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900 {% endif %}"
                        href="{% url 'form_list' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-file-text w-5 h-5 mr-3">
                            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                            <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                            <path d="M10 9H8"></path>
                            <path d="M16 13H8"></path>
                            <path d="M16 17H8"></path>
                        </svg>Forms
                    </a>
                    <a class="flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 {% if request.resolver_match.url_name == 'employee_search' or request.resolver_match.url_name == 'employee_form' %}bg-green-50 text-green-700 border-r-2 border-green-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900 {% endif %}"
                        href="{% url 'employee_search' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-users w-5 h-5 mr-3">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>Employees
                    </a>
                    <a class="flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200 {% if request.resolver_match.url_name == 'profile' %}bg-green-50 text-green-700 border-r-2 border-green-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900 {% endif %}"
                        href="{% url 'profile' %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-user w-5 h-5 mr-3">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>Profile
                    </a>
                </nav>
                <div class="p-4 border-t border-gray-200">
                    <button onclick="logout()"
                        class="inline-flex items-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 w-full justify-start text-gray-600 hover:text-red-600 hover:bg-red-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-log-out w-5 h-5 mr-3">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" x2="9" y1="12" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </div>
        <div class="md:ml-64">
            {% block content %}

            {% endblock content %}
            <!-- Toast Container -->
            <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>
        </div>
    </div>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    {% block bottom_script_cdn %}
    {% endblock bottom_script_cdn %}
</body>

</html>